---
title: "NTC_droplets"
author: "Prashant Kalvapalle"
date: '`r format(Sys.time(), "%d %B, %Y; %H:%M")`'
output: 
  html_document:
    theme: flatly
    toc: TRUE
    toc_float: TRUE
---

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = F, message = F, warning = F, fig.width = 12, fig.height = 4)
```

# NTC Positive droplets

## Static plots
```{r ntc}
plt_NTC <- {ggplot(ntc_dd.data, aes(Run_ID, PositiveDroplets, colour = Target)) +
    geom_point() + 
    geom_line(aes(y = mean_positive))} %>% 
  format_classic() %>% 
  print()

```

## Interactive: NTC

```{r ntc.interactive}

plotly::ggplotly(plt_NTC, dynamicTicks = T)

```

## NTC Positive droplets above LOD of 3

```{r ntc3}

ntc_dd.data %>%
  filter(PositiveDroplets > 3) %>% 
  mutate(mean_positive = mean(PositiveDroplets)) %>% 

  {ggplot(., aes(Run_ID, PositiveDroplets, colour = Target)) +
    geom_point() + 
    geom_line(aes(y = mean_positive))} %>% 
  format_classic() %>% 
  ggplotly(dynamicTicks = T)

```

## NTC Positive droplets: merging all targets

```{r ntcalltgt}

ntc_dd.data %>%
  # filter(PositiveDroplets > 3) %>% 
  group_by(Run_ID) %>% 
  mutate(mean_positive = mean(PositiveDroplets)) %>% 

  {ggplot(., aes(Run_ID, PositiveDroplets)) +
    geom_point() + 
    geom_line(aes(y = mean_positive))} %>% 
  format_classic() %>% 
  ggplotly(dynamicTicks = T)

```
## NTC: merging all targets, > 3

```{r ntcalltgt0}

ntc_dd.data %>%
  filter(PositiveDroplets > 3) %>%
  group_by(Run_ID) %>% 
  mutate(mean_positive = mean(PositiveDroplets)) %>% 

  {ggplot(., aes(Run_ID, PositiveDroplets)) +
    geom_point() + 
    geom_line(aes(y = mean_positive))} %>% 
  format_classic() %>% 
  ggplotly(dynamicTicks = T)

```

# Scatter plot

By target
```{r scatterntc}

pltsctr <- ntc_dd.data %>%
  # filter(PositiveDroplets > 3) %>% 
  # group_by(Run_ID) %>% 
  # mutate(mean_positive = mean(PositiveDroplets)) %>% 

  {ggplot(., aes(Target, PositiveDroplets, colour = Target)) +
      geom_jitter(width = .5)
    } %>% 
  format_classic() %>% 
  # ggplotly(dynamicTicks = T)
  print()

ntc_dd.data %>%
  {ggplot(., aes(1, PositiveDroplets, colour = Target, label = Run_ID)) +
      geom_violin() + geom_jitter(width = .5)
    } %>% 
  format_classic() %>% 
  ggplotly(dynamicTicks = T, tooltip = 'label')
  # print()

# ggplotly(pltsctr, dynamicTicks = T)

```

ordered density plots for visualization

```{r beeswarm}

ntc_dd.data %>%
  {ggplot(., aes(1, PositiveDroplets, colour = Target, label = Run_ID)) +
      geom_beeswarm(priority = 'descending')
    } %>% 
  format_classic() %>% 
  ggplotly(dynamicTicks = T, tooltip = 'label')
  # print()

```

All targets
```{r scatterntcall}

ntc_dd.data %>%
  # filter(PositiveDroplets > 3) %>% 
  # group_by(Run_ID) %>% 
  # mutate(mean_positive = mean(PositiveDroplets)) %>% 

  {ggplot(., aes(1, PositiveDroplets)) +
      geom_violin() + geom_jitter()
    } %>% 
  format_classic() %>% 
  ggplotly(dynamicTicks = T)
  # print()

```


# Summary statistics

```{r summary}

ntc_dd.data %>% 
  ungroup() %>% 
  summarise(across(PositiveDroplets, lst(mean, median, sd)))
```
Statistics for Runs with > 3 droplets (assumed LOD)

```{r summary3}

ntc_more_than_3 <- ntc_dd.data %>% 
  filter(PositiveDroplets > 3) %>% 
  mutate(mean_positive = mean(PositiveDroplets)) 

ntc_more_than_3 %>% 
  ungroup() %>% 
  summarise(across(PositiveDroplets, lst(mean, median, sd)))
```
Statistics for Runs with > 0 droplets (assumed LOD)

```{r summary0}

ntc_dd.data %>% 
  filter(PositiveDroplets > 0) %>% 
  ungroup() %>% 
  summarise(across(PositiveDroplets, lst(mean, median, sd)))
```

Total number of runs

```{r total}

ntc_dd.data %>% 
  pull(Run_ID) %>% 
  unique() %>% 
  length() 

```

Number of runs with > 3 droplets (assumed LOD)

```{r number3}

ntc_more_than_3 %>% 
  pull(Run_ID) %>% 
  unique() %>% 
  length() 

```
Number of runs with > 0 droplets

```{r number0}

ntc_dd.data %>% 
  filter(PositiveDroplets > 0) %>% 
  pull(Run_ID) %>% 
  unique() %>% 
  length() 

```

# Intensity plots

```{r intthrsholds}
all_long_dd.data <- all_dd.data %>% 
  pivot_longer(cols = c('Threshold', 'MeanAmplitudeofPositives',	'MeanAmplitudeofNegatives'), 
               names_to = 'type', values_to = 'intensity') 


plt_intensity <- {ggplot(all_long_dd.data %>% 
                           filter(!str_detect(Target, 'pMMoV')),
                         aes(Run_ID, intensity, colour = type)) +
    geom_point() + 
    geom_line() +
    facet_grid(~ Target)} %>% 
  print()

```

